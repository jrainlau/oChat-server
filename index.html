<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <textarea name="" id="chat" cols="30" rows="10"></textarea>
    <textarea name="" id="input" cols="30" rows="10"></textarea>
    <input type="text" placeholder="Room number" id="room">
    <button id="join">Join</button>
    <button id="submit">Submit</button>
    <script src="https://cdn.bootcss.com/socket.io/2.1.1/socket.io.dev.js"></script>
    <script type="text/javascript" charset="utf-8">
        const token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzU1MjgyODIsIm5iZiI6MTUzNTUyODI4MiwianRpIjoiODNjZjJiYWQtZmE4Ni00YTc1LTgxNTAtNGM1YWFkNzUxYjBhIiwiaWRlbnRpdHkiOiJ1c2VyMiIsImZyZXNoIjpmYWxzZSwidHlwZSI6ImFjY2VzcyJ9.5XekyxYdM-TSUHHYa9qhGPjRHdeMfxY3-lpRrVVDu9s'

        const socket = io.connect('http://127.0.0.1:5000/chat', {
            query: { token }
        });

        const joinBtn = document.querySelector('#join')
        const roomInput = document.querySelector('#room')
        const submitBtn = document.querySelector('#submit')
        const chat = document.querySelector('#chat')
        
        socket.on('Connect successed', (msg) => {
          console.log(msg)
        })
        socket.on('Connect failed', (msg) => {
          console.log(msg)
          socket.disconnect()
        })
        socket.on('status', (msg) => {
          chat.value += typeof msg.message === 'object'
            ? `${msg.message.user} has ${msg.message.status} ${msg.message.room}\n`
            : msg.message
        })
        socket.on('message', (msg) => {
          chat.value += msg.message + '\n'
        })

        joinBtn.addEventListener('click', () => {
          socket.emit('join', {
              room: roomInput.value
          })
        })

        submitBtn.addEventListener('click', () => {
          socket.emit('text', {
              message: input.value,
              room: roomInput.value
          })
        })
    </script>
</body>
</html>